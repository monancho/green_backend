# 알림 기능 테스트 가이드

## 1. 상담 예약 알림 테스트

### 1-1. 학생이 예약 신청 → 교수에게 알림
1. **학생 계정으로 로그인**
2. 상담 페이지에서 교수의 열린 시간대 선택
3. 예약 신청
4. **교수 계정으로 로그인**
5. Header의 종 모양 아이콘 클릭
6. 알림 목록에서 "{학생명} 학생이 {시간}에 상담 예약을 신청했습니다." 확인

### 1-2. 교수가 예약 승인 → 학생에게 알림
1. **교수 계정으로 로그인**
2. 상담 페이지에서 예약 신청된 슬롯 선택
3. 예약 승인
4. **학생 계정으로 로그인**
5. Header의 종 모양 아이콘 클릭
6. 알림 목록에서 "{교수명} 교수님이 {시간}에 상담 예약을 승인했습니다." 확인

### 1-3. 교수가 예약 취소 → 학생에게 알림
1. **교수 계정으로 로그인**
2. 상담 페이지에서 예약된 슬롯 선택
3. 예약 취소
4. **학생 계정으로 로그인**
5. Header의 종 모양 아이콘 클릭
6. 알림 목록에서 "{교수명} 교수님이 {시간}에 예정된 상담 예약을 취소했습니다." 확인

## 2. 회의 시작 10분 전 알림 테스트

### 방법 1: 실제 시간으로 테스트
1. **교수 계정으로 로그인**
2. 상담 시간 슬롯 생성 (현재 시간 + 10분 후)
3. 학생이 예약 신청
4. 교수가 예약 승인
5. **10분 대기**
6. 교수와 학생 모두 Header의 종 모양 아이콘에서 "10분 후에 시작됩니다" 알림 확인

### 방법 2: 스케줄러 수정하여 즉시 테스트 (개발용)
- `MeetingReminderScheduler.java`의 시간 범위를 수정:
  ```java
  // 현재 시간 + 10분 → 현재 시간 + 1분으로 변경
  Timestamp startTime = Timestamp.valueOf(now.plusMinutes(1));
  Timestamp endTime = Timestamp.valueOf(now.plusMinutes(2));
  ```
- 예약 시작 시간을 현재 시간 + 1분으로 설정
- 1분 후 알림 확인

### 방법 3: 테스트 API 사용 (즉시 테스트)
```
POST http://localhost:8881/api/test/meeting-reminder
```
- 스케줄러를 즉시 실행하여 10분 후 시작하는 회의 알림 발송

## 3. 위험도 분석 알림 테스트

### 3-1. 수동 분석 실행 (즉시 테스트)
1. **API 호출로 분석 실행**:
   ```
   POST /api/ai-analysis/analyze-all
   Body: { "year": 2024, "semester": 2 }
   ```
2. 위험 상태인 학생이 있는지 확인
3. **학생 계정으로 로그인** → 알림 확인
4. **교수 계정으로 로그인** → 알림 확인

### 3-2. 상담 완료로 위험도 변경 테스트
1. **교수 계정으로 로그인**
2. 상담 페이지에서 상담 완료 처리
3. 상담 내용에 위험한 내용 입력 (예: "자퇴를 고민하고 있습니다")
4. AI 분석 후 위험도가 RISK 또는 CRITICAL로 변경되면
5. **학생과 교수 모두 알림 확인**

## 4. 매일 자동 분석 스케줄러 테스트

### 방법 1: 테스트 API 사용 (권장)
```
POST http://localhost:8881/api/test/daily-analysis
```
- 즉시 위험도 분석 실행
- 위험 상태인 학생이 있으면 알림 발송

### 방법 2: 스케줄러 시간 변경 (개발용)
`DailyRiskAnalysisScheduler.java` 수정:
```java
// 매일 오전 9시 → 1분마다 실행으로 변경 (테스트용)
@Scheduled(fixedRate = 60000) // 1분마다 실행
```

### 방법 3: 전체 분석 API 직접 호출
```
POST http://localhost:8881/api/ai-analysis/analyze-all
Body: { "year": 2024, "semester": 2 }
```

## 5. 알림 UI 테스트

### 5-1. 알림 아이콘 확인
1. 로그인 후 Header 우상단 확인
2. 알림이 있으면 빨간색 배지에 숫자 표시
3. 알림이 없으면 배지 없음

### 5-2. 알림 목록 확인
1. 종 모양 아이콘 클릭
2. 알림 목록 드롭다운 표시
3. 읽지 않은 알림은 파란색 배경
4. 읽은 알림은 흰색 배경

### 5-3. 알림 읽음 처리
1. 알림 클릭 → 자동으로 읽음 처리
2. "모두 읽음" 버튼 클릭 → 모든 알림 읽음 처리
3. 배지 숫자 감소 확인

### 5-4. 알림 비우기
1. "비우기" 버튼 클릭
2. 확인 다이얼로그에서 확인
3. 모든 알림 삭제 확인

## 6. 데이터베이스 확인

### 알림 데이터 확인
```sql
-- 모든 알림 조회
SELECT * FROM notification_tb ORDER BY created_at DESC;

-- 특정 사용자의 알림 조회
SELECT * FROM notification_tb WHERE user_id = {사용자ID} ORDER BY created_at DESC;

-- 읽지 않은 알림 개수
SELECT COUNT(*) FROM notification_tb WHERE user_id = {사용자ID} AND is_read = 0;
```

## 7. 로그 확인

백엔드 콘솔에서 다음 로그 확인:
- `"회의 시작 10분 전 알림 발송: ..."`
- `"매일 자동 위험도 분석 시작"`
- `"위험 알림 발송 실패: ..."` (오류 발생 시)

## 8. 빠른 테스트 체크리스트

- [ ] 학생 예약 신청 → 교수 알림 확인
- [ ] 교수 예약 승인 → 학생 알림 확인
- [ ] 교수 예약 취소 → 학생 알림 확인
- [ ] 회의 시작 10분 전 알림 (시간 조정 필요)
- [ ] 위험도 분석 → 학생/교수 알림 확인
- [ ] 알림 아이콘 배지 표시 확인
- [ ] 알림 읽음 처리 확인
- [ ] 알림 비우기 기능 확인

